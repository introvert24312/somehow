---
title: t检验
date: 2024-4-5 13:50:00
tags: 统计学
categories: 卫生统计学
mathjax: true
---

# 使用t检验的一般流程

```mermaid
graph TD
    0[(随机样本<br>来自正态分布总体<br>比较均数时方差相等)]:::highlight
    0 -->|建立假设|1{选择适当的t检验类型}
    1 --> 2(独立样本T检验)
    1 --> 3(配对样本T检验)
    1 --> 4(单样本T检验)
    2 --> 5(计算t值)
    3 --> 5
    4 --> 5
    5 --> 6(确定显著性水平 α)
    6 --> 7(查找t分布表以确定临界t值)
    7 --> 8{比较计算得到的t值与临界t值}
    8 -->|计算的t值 大于 临界t值| 9(拒绝零假设,接受备择假设,差异显著)
    8 -->|计算的t值 小于等于 临界t值| 10(不能拒绝零假设,差异不显著)
    
 classDef highlight fill:#ffff00,stroke:#333,stroke-width:2px;

```

# 两独立样本t检验

```mermaid
graph TD
    0[收集两个班级的成绩数据]
    0 --> |根据F检验分布图|1[进行方差齐性检验]
    1 -->|方差相等| 2[选择标准独立样本T检验]
    1 -->|方差不等| 3[选择Welch的T检验]
    2 --> 4[计算T值]
    3 --> 4
    4 --> 5[确定显著性水平 α]
    5 --> 6[与临界值比较]
    6 -->|T值 大于 临界值| 7[结论:两班成绩有显著差异]
    6 -->|T值 小于等于 临界值| 8[结论:两班成绩无显著差异]

```



## 原始数据

```py
# 将班级A和班级B的成绩罗列出来
classA_scores, classB_scores

Result
(array([78.97371322, 73.89388559, 80.1815083 , 87.18423885, 73.126773  ,
        73.12690434, 87.63370252, 81.13947783, 71.24420491, 79.34048035,
        71.29265846, 71.27416197, 76.93569817, 59.69375804, 61.20065734,
        70.50169977, 66.89735104, 77.51397866, 67.7358074 , 63.70157039,
        86.72519015, 73.1937896 , 75.54022564, 63.60201451, 70.6449382 ,
        75.88738072, 65.79205138, 78.00558415, 70.19489048, 72.66645   ]),
 array([71.98293388, 96.52278185, 77.86502775, 67.42289071, 86.22544912,
        65.7915635 , 80.08863595, 58.40329876, 64.71813951, 79.96861236,
        85.3846658 , 79.71368281, 76.84351718, 74.98896304, 63.2147801 ,
        70.80155792, 73.39361229, 88.57122226, 81.4361829 , 60.36959845,
        81.24083969, 74.1491772 , 71.23078222, 84.11676289, 88.30999522]))
```

## 进行Levene’s 方差齐性检验

### W的计算

根据我们的示例计算：

A：班级A的平均成绩为83.5分。

B：班级B的平均成绩为86.4分。

C：班级A的平均绝对偏差为4.9分。

D：班级B的平均绝对偏差为4.0分。

{% fold 步骤C/D %}
1. **计算学生成绩的平均值** 
2. **计算每个学生成绩与平均值的绝对差异**
3. **求这些绝对差异的平均值**
 {% endfold %}

E：所有数据的总体平均绝对偏差为4.45分。

F：Levene统计量$W$的计算结果为0.403。

{% fold 计算统计量(W) %}

  Levene统计量$W$的计算基于方差分析（ANOVA）原理，具体公式为：

$$
W = \frac{(N - k) \sum_{i=1}^{k} n_i (Z_i - Z)^2}{(k - 1) \sum_{i=1}^{k} \sum_{j=1}^{n_i} (|x_{ij} - \bar{x}_i| - Z_i)^2}
$$

其中：

对于两个班级（班级A和班级B）的数学考试成绩进行Levene的方差齐性检验，具体的字母与数字的对应关系如下：

- $N$：总的观测值数量，即两个班级学生总数。班级A有10名学生，班级B也有10名学生，所以$N = 10 + 10 = 20$。
- $k$：组的数量，在这个例子中有两个班级，所以$k=2$。
- $n_i$：第$i$个组中的观测值数量。对于班级A，$n_A = 10$；对于班级B，$n_B = 10$。
- $Z_i$：第$i$个组的绝对偏差均值。在之前的计算中，我们发现班级A的平均绝对偏差$Z_A = 4.9$，班级B的平均绝对偏差$Z_B = 4.0$。
- $Z$：所有观测值绝对偏差的全体均值，即合并班级A和班级B所有绝对偏差后的平均值，计算得$Z = 4.45$。
- $|x_{ij} - \bar{x}_i|$：第$i$个组中第$j$个观测值相对于其组平均值的绝对偏差。对于班级A和班级B的每个学生，我们分别计算了他们的成绩与各自班级平均成绩的绝对差值。

利用上述信息，我们能够计算Levene统计量$W$。在这个例子中，我们已经通过一系列步骤计算出了$W$的值为0.403。这个值表明了我们如何利用给定的数据和Levene检验公式来评估两个班级成绩方差的齐性。在实际操作中，我们会进一步利用这个$W$值来确定其对应的p值，从而做出是否拒绝方差齐性零假设的决策。

 {% endfold %}


Levene统计量$W$表示的是在我们的示例数据中，两个班级成绩的方差齐性的检验统计量。计算出的$W$值用来与F分布的临界值进行比较，以决定是否拒绝方差齐性的零假设。在实际应用中，我们通常还需要查找或通过统计软件获取相应的p值，以确定这个统计量在给定显著性水平下的显著性。

### 各种F分布图

![分母与自由度变换时F的分布簇](https://raw.githubusercontent.com/introvert24312/image/master/分母与自由度变换时F的分布簇.png)
根据参数为（自由度、分母)的F图像，得出p值

0假设通常是两条统计量相等，若p值较小那么是一个小概率事件，即拒绝0假设，得出两统计量不相等

~~*本文篇幅有限，仅仅探究方差相等（即方差齐性的情况）*算了…..我还是写完它吧~~

## 选择标准独立样本T检验并计算t值（假设方差相等）




标准的独立样本T检验使用池化方差（$s_p^2$）来估计标准误差，适用于当我们假设两个样本的方差相等时。其计算步骤如下：



1. ### **计算池化方差**:

$$
 s_p^2 = \frac{(n_1 - 1)s_1^2 + (n_2 - 1)s_2^2}{n_1 + n_2 - 2} 
$$


   其中，$n_1$和$n_2$是两个样本的大小，$s_1^2$和$s_2^2$是两个样本的方差。



2. ### **计算标准误差**（SE）:

$$
  SE = \sqrt{s_p^2\left(\frac{1}{n_1} + \frac{1}{n_2}\right)}
$$



3. ### **计算T值**:

$$
  T = \frac{\bar{x}_1 - \bar{x}_2}{SE}
$$

  其中，$\bar{x}_1$和$\bar{x}_2$是两个样本的平均值。

4. ### 自由度的计算

   $$
   df =  (n_1 + n_2 - 2)。
   $$

   

## 选择Welch’sT检验并计算t值（不假设方差相等）


Welch的T检验是一种更通用的方法，它不要求两个样本的方差相等，因此适用于更广泛的情形。其计算步骤如下：


1. ### **直接计算每个样本的标准误差**:

$$
  SE_1 = \frac{s_1^2}{n_1}, \quad SE_2 = \frac{s_2^2}{n_2} 
$$


2. ### **计算两个样本标准误差的和的平方根**（总标准误差，SE）:

$$
  SE = \sqrt{SE_1 + SE_2} 
$$



3. ### **计算T值**:

$$
  T = \frac{\bar{x}_1 - \bar{x}_2}{SE} 
$$



4. ### **自由度的计算**



对于Welch的T检验，自由度（df）的计算比标准T检验复杂，使用以下公式：

$$
df = \frac{(SE_1 + SE_2)^2}{\frac{SE_1^2}{n_1 - 1} + \frac{SE_2^2}{n_2 - 1}}
$$

---

## 总结与实操



\- **标准T检验**假设两个独立样本具有相同的方差，并使用池化方差来计算标准误差和T值。

\- **Welch T检验**不要求两个样本的方差相等，直接计算每个样本的标准误差来估计总标准误差，并据此计算T值，通常给出一个更保守的自由度估计。

在我们的例子中，使用班级A和班级B的数学成绩进行计算：

### 标准的独立样本T检验（假设方差相等）

- **T值**：-1.141
- **\(p\)值**：0.269
- **自由度（df）**：18

### Welch的T检验（不假设方差相等）

- **T值**：-1.141
- **\(p\)值**：0.269
- **自由度（df）**：约17.52

### 解释

在这个例子中，不论是使用标准的独立样本T检验还是Welch的T检验，我们都得到了相似的T值和\(p\)值，表明在显著性水平0.05下，我们没有足够的证据拒绝零假设，即两个班级的数学成绩没有显著差异。这种情况下，班级A和班级B的成绩可以认为在统计学上是相等的。

自由度的差异主要源于两种方法对样本方差不同假设的处理方式。Welch的T检验因为不假设方差齐性，所以通常会有一个略微不同的、更保守的自由度估计。

这个例子展示了如何根据样本方差是否相等，选择合适的独立样本T检验方法，并进行计算。在实际研究中，选择哪种方法取决于样本方差的性质以及研究者的偏好。

